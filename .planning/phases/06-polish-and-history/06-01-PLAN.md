---
phase: 06-polish-and-history
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/components/SyncStatusBadge.svelte
  - src/routes/(app)/+page.svelte
  - src/lib/sync/engine.svelte.ts
autonomous: true

must_haves:
  truths:
    - "User sees visual indicator when a chore is pending sync"
    - "User sees visual indicator when a chore failed to sync"
    - "User can retry failed syncs with one tap"
    - "Sync status indicator animates smoothly (not jarring)"
  artifacts:
    - path: "src/lib/components/SyncStatusBadge.svelte"
      provides: "Reusable sync status indicator component"
      min_lines: 40
    - path: "src/routes/(app)/+page.svelte"
      provides: "Enhanced chore list with sync badges and retry"
      contains: "SyncStatusBadge"
  key_links:
    - from: "src/routes/(app)/+page.svelte"
      to: "SyncStatusBadge.svelte"
      via: "component import and usage"
      pattern: "import SyncStatusBadge"
    - from: "src/routes/(app)/+page.svelte"
      to: "syncEngine.retryFailed()"
      via: "retry button click handler"
      pattern: "syncEngine\\.retryFailed"
---

<objective>
Create polished sync status indicators that give users clear visibility into offline/sync state for each chore item, with ability to retry failed syncs.

Purpose: Users in the field need to know which changes are pending, synced, or failed without confusion. Clear visual feedback builds trust in the offline-first system.

Output: SyncStatusBadge component with pending/synced/failed states, enhanced chore list UI with badges, and global retry capability for failed syncs.
</objective>

<execution_context>
@/Users/mike.wojnarowski/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mike.wojnarowski/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-polish-and-history/06-RESEARCH.md
@src/routes/(app)/+page.svelte
@src/lib/sync/engine.svelte.ts
@src/lib/db/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SyncStatusBadge component</name>
  <files>src/lib/components/SyncStatusBadge.svelte</files>
  <action>
Create a reusable SyncStatusBadge.svelte component that displays sync status visually:

Props:
- `status`: 'pending' | 'synced' | 'failed'

Behavior:
- **pending**: Pulsing amber dot with CSS animation (not JavaScript)
- **synced**: Hidden (opacity: 0) - no visual noise when everything is synced
- **failed**: Red exclamation mark, always visible

Use CSS animations for the pulse effect:
```css
@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(0.85); }
}
```

Requirements:
- Minimum 44px touch target (in case we add tap-to-retry per item later)
- aria-label for accessibility
- Scoped CSS (no Tailwind)
- Use the pattern from research: `.sync-indicator--{status}` for status-specific styles
  </action>
  <verify>Component file exists with pending/synced/failed states. CSS includes pulse animation.</verify>
  <done>SyncStatusBadge.svelte renders correct visual for each status with smooth pulse animation.</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SyncStatusBadge into chore list</name>
  <files>src/routes/(app)/+page.svelte</files>
  <action>
Update the chore list page to use SyncStatusBadge:

1. Import SyncStatusBadge component
2. Replace the inline sync status spans (lines ~133-137) with SyncStatusBadge
3. Add a retry button in the header when syncEngine.failedCount > 0
4. Wire retry button to call syncEngine.retryFailed()

Header section updates:
- Show failed count with retry button: "3 failed - Retry"
- Button should call syncEngine.retryFailed() onclick
- Style retry button as link-style text button (not prominent)

Debounce consideration from research:
- The existing syncStatus on chores updates via the store, which already has some natural latency from IndexedDB -> UI. No additional debouncing needed initially.

Keep existing styling patterns - scoped CSS, no Tailwind.
  </action>
  <verify>Run `npm run dev`, complete a chore while offline, see pending indicator. Simulate failed sync (if possible via network throttle), see failed indicator with retry button.</verify>
  <done>Chore list shows SyncStatusBadge for each item; retry button appears when failed count > 0.</done>
</task>

<task type="auto">
  <name>Task 3: Add retry capability to sync engine</name>
  <files>src/lib/sync/engine.svelte.ts</files>
  <action>
Verify and enhance the sync engine's retry capability:

1. Check if `retryFailed()` method exists - it should based on research
2. If missing, add a `retryFailed()` method that:
   - Gets all items with syncStatus === 'failed' from IndexedDB
   - Updates their syncStatus to 'pending'
   - Calls processQueue() to attempt sync

Also add a `failedCount` getter if not present:
- Returns count of items in queue with status 'failed'

The method should handle both chores and dailyChores tables.

Note: Based on codebase grep, ChoreStore already has failedCount. Ensure syncEngine exposes this or aggregates from stores.
  </action>
  <verify>Check that syncEngine has retryFailed method. In dev, manually set a chore's syncStatus to 'failed' in IndexedDB devtools, call retryFailed, verify it requeues.</verify>
  <done>syncEngine.retryFailed() exists and requeues failed items for sync retry.</done>
</task>

</tasks>

<verification>
1. Start dev server: `npm run dev`
2. Complete a chore - should show brief pending state then sync
3. Go offline (browser devtools Network > Offline)
4. Complete another chore - should show persistent pending indicator
5. Go back online - should sync and indicator disappears
6. Check that synced chores show no indicator (clean UI)
</verification>

<success_criteria>
- SyncStatusBadge component renders three distinct states
- Chore list uses SyncStatusBadge for all items
- Retry button appears when failed count > 0
- Clicking retry triggers syncEngine.retryFailed()
- UI is clean (no indicator noise when fully synced)
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-and-history/06-01-SUMMARY.md`
</output>
